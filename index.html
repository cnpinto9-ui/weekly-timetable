<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Weekly Timetable</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  padding: 20px;
}

h1 {
  text-align: center;
}

.controls {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 20px;
}

input, select, button {
  padding: 6px;
  font-size: 14px;
}

.timetable {
  display: grid;
  grid-template-columns: 90px repeat(7, 1fr);
  background: #ccc;
}

.header, .time {
  background: #eee;
  text-align: center;
  font-weight: bold;
  padding: 8px;
  border: 1px solid #ccc;
}

.cell {
  background: #fff;
  height: 50px;
  position: relative;
  border: 1px solid #ddd;
}

.block {
  position: absolute;
  width: 100%;
  color: white;
  padding: 4px;
  font-size: 12px;
  border-radius: 4px;
  cursor: grab;
  overflow-y: auto;
}

.block button {
  font-size: 10px;
  margin-top: 4px;
}
</style>
</head>

<body>

<h1>Weekly Timetable</h1>

<div class="controls">
  <input id="blockName" placeholder="Block name (e.g. Work)">
  <select id="blockDuration">
    <option value="1">1 hour</option>
    <option value="2">2 hours</option>
    <option value="3">3 hours</option>
    <option value="4">4 hours</option>
    <option value="5">5 hours</option>
    <option value="8">8 hours</option>
  </select>
  <button id="createBtn">Create Block</button>
</div>

<div id="timetable" class="timetable"></div>

<script>
/* ---------- CONFIG ---------- */
const days = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
const startHour = 10;
const endHour = 24;                 // midnight
const totalHours = endHour - startHour;
const hourHeight = 50;

/* ---------- STATE ---------- */
const timetable = document.getElementById("timetable");
const blockNameInput = document.getElementById("blockName");
const blockDurationSelect = document.getElementById("blockDuration");
const createBtn = document.getElementById("createBtn");

const colors = {};
let draggedBlock = null;

/* ---------- HELPERS ---------- */
function formatHour(h) {
  if (h === 24) return "12:00 AM";
  const suffix = h >= 12 ? "PM" : "AM";
  const hour = h % 12 === 0 ? 12 : h % 12;
  return `${hour}:00 ${suffix}`;
}

function getColor(name) {
  if (!colors[name]) {
    colors[name] = `hsl(${Math.random() * 360}, 70%, 50%)`;
  }
  return colors[name];
}

/* ---------- BUILD GRID ---------- */
timetable.appendChild(document.createElement("div")); // empty corner

days.forEach(day => {
  const h = document.createElement("div");
  h.className = "header";
  h.textContent = day;
  timetable.appendChild(h);
});

for (let i = 0; i < totalHours; i++) {
  const time = document.createElement("div");
  time.className = "time";
  time.textContent = formatHour(startHour + i);
  timetable.appendChild(time);

  days.forEach(() => {
    const cell = document.createElement("div");
    cell.className = "cell";

    cell.addEventListener("dragover", e => e.preventDefault());
    cell.addEventListener("drop", () => {
      if (draggedBlock) {
        cell.appendChild(draggedBlock);
        draggedBlock.style.top = "0";
      }
    });

    timetable.appendChild(cell);
  });
}

/* ---------- BLOCK CREATION ---------- */
createBtn.onclick = () => {
  const name = blockNameInput.value.trim();
  const duration = Number(blockDurationSelect.value);

  if (!name) {
    alert("Enter a block name");
    return;
  }

  createBlock(name, duration, getColor(name));
};

function createBlock(name, duration, color) {
  const block = document.createElement("div");
  block.className = "block";
  block.draggable = true;

  block.style.background = color;
  block.style.height = `${duration * hourHeight}px`;

  block.dataset.name = name;
  block.dataset.duration = duration;
  block.dataset.color = color;

  updateBlockText(block);

  block.addEventListener("dragstart", () => draggedBlock = block);

  block.ondblclick = () => {
    const newName = prompt("Edit block name:", block.dataset.name);
    if (newName) {
      block.dataset.name = newName;
      block.dataset.color = getColor(newName);
      block.style.background = block.dataset.color;
      updateBlockText(block);
    }
  };

  document.querySelector(".cell").appendChild(block);
}

/* ---------- BLOCK TEXT ---------- */
function updateBlockText(block) {
  const duration = Number(block.dataset.duration);
  block.innerHTML = "";

  for (let i = 0; i < duration; i++) {
    block.innerHTML += `${formatHour(startHour + i)} ${block.dataset.name}<br>`;
  }

  const dup = document.createElement("button");
  dup.textContent = "Duplicate";
  dup.onclick = e => {
    e.stopPropagation();
    createBlock(
